<!DOCTYPE html>
<html lang="en">
<!-- Beautiful Jekyll 5.0.0 | Copyright Dean Attali 2020 -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>Optimizing Python (List Comprehension)</title>

  
  <meta name="author" content="Mark M. Meysenburg">
  

  <meta name="description" content="Don't build a list with a for loop">

  

  

  <link rel="alternate" type="application/rss+xml" title="Doane CCLA HPC Workshop" href="http://localhost:4000/feed.xml">

  

  

  

  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/assets/css/beautifuljekyll.css">
    
  

  

  
  
  

  

  
  <meta property="og:site_name" content="Doane CCLA HPC Workshop">
  <meta property="og:title" content="Optimizing Python (List Comprehension)">
  <meta property="og:description" content="Don't build a list with a for loop">

  
  <meta property="og:image" content="http://localhost:4000/assets/img/avatar-icon.png">
  

  
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://localhost:4000/pages/optimizing-python-list-comprehension/">
  <link rel="canonical" href="http://localhost:4000/pages/optimizing-python-list-comprehension/">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@MarkMm91416">
  <meta name="twitter:creator" content="@MarkMm91416">

  <meta property="twitter:title" content="Optimizing Python (List Comprehension)">
  <meta property="twitter:description" content="Don't build a list with a for loop">

  
  <meta name="twitter:image" content="http://localhost:4000/assets/img/avatar-icon.png">
  

  


  

  

</head>


<body>

  


  <nav class="navbar navbar-expand-xl navbar-light fixed-top navbar-custom top-nav-regular"><a class="navbar-brand" href="http://localhost:4000/">Doane CCLA HPC Workshop</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="/aboutme">About Me</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="https://www.doane.edu/center-for-computing-in-the-liberal-arts">Doane CCLA</a>
                  <a class="dropdown-item" href="https://www.doane.edu/divas-project">Doane DIVAS</a>
            </div>
          </li>
        
          <li class="nav-item">
            <a class="nav-link" href="https://www.doane.edu/mark-meysenburg">Author's home</a>
          </li>
        <li class="nav-item">
          <a class="nav-link" id="nav-search-link" href="#" title="Search">
            <span id="nav-search-icon" class="fa fa-search"></span>
            <span id="nav-search-text">Search</span>
          </a>
        </li></ul>
  </div>

  

  
    <div class="avatar-container">
      <div class="avatar-img-border">
        <a href="http://localhost:4000/">
          <img alt="Navigation bar avatar" class="avatar-img" src="/assets/img/avatar-icon.png" />
        </a>
      </div>
    </div>
  

</nav>



<div id="beautifuljekyll-search-overlay">

  <div id="nav-search-exit" title="Exit search">✕</div>
  <input type="text" id="nav-search-input" placeholder="Search">
  <ul id="search-results-container"></ul>
  
  <script src="https://unpkg.com/simple-jekyll-search@latest/dest/simple-jekyll-search.min.js"></script>
  <script>
    var searchjson = '[ \
       \
        { \
          "title"    : "Sample blog post", \
          "category" : "test", \
          "url"      : "/2020-02-28-test-markdown/", \
          "date"     : "February 28, 2020" \
        }, \
       \
        { \
          "title"    : "Flake it till you make it", \
          "category" : "bookstest", \
          "url"      : "/2020-02-26-flake-it-till-you-make-it/", \
          "date"     : "February 26, 2020" \
        }, \
       \
       \
        { \
          "title"    : "About me", \
          "category" : "page", \
          "url"      : "/aboutme/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Doane CCLA HPC Workshop", \
          "category" : "page", \
          "url"      : "/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Doane CCLA HPC Workshop", \
          "category" : "page", \
          "url"      : "/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Optimizing Python (List Comprehension)", \
          "category" : "page", \
          "url"      : "/pages/optimizing-python-list-comprehension/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Optimizing Python (Overview)", \
          "category" : "page", \
          "url"      : "/pages/optimizing-python-overview/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Tag Index", \
          "category" : "page", \
          "url"      : "/tags/", \
          "date"     : "January 1, 1970" \
        } \
       \
    ]';
    searchjson = JSON.parse(searchjson);

    var sjs = SimpleJekyllSearch({
      searchInput: document.getElementById('nav-search-input'),
      resultsContainer: document.getElementById('search-results-container'),
      json: searchjson
    });
  </script>
</div>





  <!-- TODO this file has become a mess, refactor it -->







<header class="header-section ">

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="page-heading">
          <h1>Optimizing Python (List Comprehension)</h1>
          
            
              <hr class="small">
              <span class="page-subheading">Don't build a list with a for loop</span>
            
          

          
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class=" container-md " role="main">
  <div class="row">
    <div class=" col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 ">
      

      <h2 id="introduction">Introduction</h2>

<p>One of the fundamental data structures in Python is the list. Often,
we create lists based on existing lists, or based on some iterated
values. In many of these cases, it is natural to use a <code class="language-plaintext highlighter-rouge">for</code> loop to create
the list.</p>

<p>For example, suppose we are studying the quality of a pseudo-random number
generator (PRNG). To do that, we require large quantities of numbers produced by 
the PRNG, which we will pass through a series of statistical tests to determine
if the PRNG produces numbers that are “random” enough. We could prepare for 
the statistical work by creating a large Python list of pseudo-random numbers.
The straightforward approach to this task is to create and empty list, and then 
use a <code class="language-plaintext highlighter-rouge">for</code> loop to populate the list, as shown in the following code:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="c1"># Sample 1: Building a list with a for loop
</span>
<span class="c1"># n contains number of values to create
</span><span class="kn">import</span> <span class="nn">random</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="c1"># part a 
</span>    <span class="n">values</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">random</span><span class="p">())</span> <span class="c1"># part b</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h2 id="simple-list-comprehension">Simple list comprehension</h2>

<p>Python provides a mechanism for creating lists, called <em>list comprehension</em>, 
that can be used in many instances where we might normally use a <code class="language-plaintext highlighter-rouge">for</code> loop. 
List comprehension is significantly faster than the equivalent <code class="language-plaintext highlighter-rouge">for</code> loop 
code. There are several, successively more complicated ways to use list 
comprehension, but the efficiency-boosting advice of this page is: <strong>if you
are using a loop to build a list, see if you can use list comprehension 
instead.</strong></p>

<p class="box-warning"><strong>Tip:</strong> If possible, build lists with list comprehension instead of loops.</p>

<p>In the random-list-building code above, we have the <code class="language-plaintext highlighter-rouge">for</code> loop first 
(line 4, labeled as <code class="language-plaintext highlighter-rouge">part a</code>), and the expression producing each
number that is appended to the list second (in line 5, labeled as
<code class="language-plaintext highlighter-rouge">part b</code>). List comprehension turns the order of those two elements around, 
as shown here:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="o">&lt;</span><span class="n">expression</span><span class="o">&gt;</span> <span class="k">for</span> <span class="o">&lt;</span><span class="n">v1</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">seq1</span><span class="o">&gt;</span><span class="p">]</span>
</code></pre></div></div>

<p>Here, <code class="language-plaintext highlighter-rouge">&lt;expression&gt;</code> corresponds to <code class="language-plaintext highlighter-rouge">part b</code>, while <code class="language-plaintext highlighter-rouge">for &lt;v1&gt; in &lt;seq1&gt;</code>
corresponds to <code class="language-plaintext highlighter-rouge">part b</code>. Essentially, the body of the <code class="language-plaintext highlighter-rouge">for</code> loop is 
specified first, and the <code class="language-plaintext highlighter-rouge">for</code> loop information itself is specified
second.</p>

<p>In our list comprehension syntax, <code class="language-plaintext highlighter-rouge">&lt;expression&gt;</code> may be any valid
Python expression. The angle brackets (<code class="language-plaintext highlighter-rouge">&lt; &gt;</code>) are not part of the 
expression; instead, they mean that <code class="language-plaintext highlighter-rouge">&lt;expression&gt;</code> is to be replaced by
some valid Python expression. Similarly, <code class="language-plaintext highlighter-rouge">&lt;v1&gt;</code> is the <code class="language-plaintext highlighter-rouge">for</code> loop 
variable, and <code class="language-plaintext highlighter-rouge">&lt;seq1&gt;</code> is the Python sequence to iterate over. 
The <code class="language-plaintext highlighter-rouge">&lt;expression&gt;</code> may depend somehow on the loop variable <code class="language-plaintext highlighter-rouge">&lt;v1&gt;</code>,
but that is not required.</p>

<p>Using list comprehension, we can create a list of random values 
in a single line of Python code, rather than the three lines required
in the <code class="language-plaintext highlighter-rouge">for</code> loop version, <em>and</em> our code will be faster than the 
<code class="language-plaintext highlighter-rouge">for</code> loop version. Here is the equivalent code using list comprehension:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="c1"># Sample 2: building a similar list with comprehension
</span>
<span class="c1"># n contains number of values to create
</span><span class="kn">import</span> <span class="nn">random</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="p">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Line 2 of this code does all the work. Here, <code class="language-plaintext highlighter-rouge">random.random()</code> is the
<code class="language-plaintext highlighter-rouge">&lt;expression&gt;</code>, a.k.a. <code class="language-plaintext highlighter-rouge">part b</code>, <code class="language-plaintext highlighter-rouge">i</code> is <code class="language-plaintext highlighter-rouge">&lt;v1&gt;</code>, and <code class="language-plaintext highlighter-rouge">range(n)</code> 
is <code class="language-plaintext highlighter-rouge">&lt;seq1&gt;</code>. Note that in this case, the expression <code class="language-plaintext highlighter-rouge">random.random()</code>
does not depend at all on the loop variable <code class="language-plaintext highlighter-rouge">i</code>.</p>

<p>To illustrate the performance improvement obtained through list comprehension, 
we executed Sample 1 and Sample 2 for values of <code class="language-plaintext highlighter-rouge">n</code> ranging from 
1,000,000 to 100,000,000 in increments of 1,000,000, and recorded the runtimes
for each trial.</p>

<p class="box-note"><strong>Note:</strong> All performance figures in this workshop were obtained on
a Windows 10 PC with an Intel(R) Core(TM) i5-9600K CPU @ 3.70GHz,
with 32GB of RAM, in Python 3.6.9 running in an Ubuntu Windows
Subsystem for Linux environment.</p>

<p>Here is a plot showing the runtimes from our trials.</p>

<p><img src="https://i.imgur.com/SFw3ChO.png" alt="Loop vs. comprehension" /></p>

<p>It is clear from the plot that list comprehension is significantly faster
than creating the list via a <code class="language-plaintext highlighter-rouge">for</code> loop!</p>

<h2 id="list-comprehension-with-an-if">List comprehension with an <code class="language-plaintext highlighter-rouge">if</code></h2>

<p>List comprehension syntax with an <code class="language-plaintext highlighter-rouge">if</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="o">&lt;</span><span class="n">expression</span><span class="o">&gt;</span> <span class="k">for</span> <span class="o">&lt;</span><span class="n">v1</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">seq1</span><span class="o">&gt;</span> <span class="k">if</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span>
</code></pre></div></div>
<h2 id="list-comprehension-with-multiple-fors">List comprehension with multiple <code class="language-plaintext highlighter-rouge">for</code>s</h2>

<p>List comprehension syntax with multiple <code class="language-plaintext highlighter-rouge">for</code>s:</p>

<pre><code class="language-pyhthon">[&lt;expression&gt; for &lt;v1&gt; in &lt;seq1&gt; 
              for &lt;v2&gt; in &lt;seq2&gt;
              for &lt;v3&gt; in &lt;seq3&gt;
              ...
              if &lt;condition&gt;]
</code></pre>

<p>Sample code showing how list comprehension with multiple <code class="language-plaintext highlighter-rouge">for</code> statements
works:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="n">letters</span> <span class="o">=</span> <span class="p">[</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'c'</span><span class="p">,</span> <span class="s">'d'</span><span class="p">]</span>
<span class="n">digits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">values</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">letters</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">digits</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Output of the preceding example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[('a', 1), ('a', 2), ('a', 3), ('b', 1), ('b', 2), ('b', 3), ('c', 1), ('c', 2), ('c', 3), ('d', 1), ('d', 2), ('d', 3)]
</code></pre></div></div>

<h2 id="exercise">Exercise</h2>

<p>Exercise: the code shown below creates a large list of pseudo-random
numbers in [0, 100000), then uses a <code class="language-plaintext highlighter-rouge">for</code> loop to create a new list 
containing only the even values. Re-write this code to use list 
comprehension to create the <code class="language-plaintext highlighter-rouge">evenValues</code> list.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="c1"># list creation
</span><span class="n">rawValues</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="p">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100000000</span><span class="p">)]</span>

<span class="c1"># loop version
</span><span class="n">evenValues</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rawValues</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">evenValues</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>


      

      

    </div>
  </div>
</div>


  <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <ul class="list-inline text-center footer-links"><li class="list-inline-item">
    <a href="/feed.xml" title="RSS">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">RSS</span>
    </a>
  </li><li class="list-inline-item">
    <a href="mailto:mark.meysenburg@doane.edu" title="Email me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Email me</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://github.com/mmeysenburg" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://twitter.com/MarkMm91416" title="Twitter">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Twitter</span>
   </a>
  </li></ul>

      
      <p class="copyright text-muted">
      
        Mark M. Meysenburg
        &nbsp;&bull;&nbsp;
      
      2021

      

      
      </p>
      <p class="theme-by text-muted">
        Powered by
        <a href="https://beautifuljekyll.com">Beautiful Jekyll</a>
      </p>
      </div>
    </div>
  </div>
</footer>


  
  
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/assets/js/beautifuljekyll.js"></script>
    
  









</body>
</html>
